<!DOCTYPE html>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.2</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <script type="text/javascript" src="./js/jquery.min.js"></script>
    <script src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
    <script type="text/javascript" src="./js/Base64.js"></script>
    <script type="text/javascript" src="./js/auth.js"></script>
    <script type="text/javascript" src="./js/fengtoos.js"></script>
    <script type="text/javascript" src="./js/api.js"></script>
    <script type="text/javascript" src="./js/powerbi.min.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<style>
    #reportContainer {
        position:absolute;
        top: 0;
        bottom:0;
        left:0;
        right:0;
    }
</style>
<body>
    <div id="reportContainer"></div>
</body>
<script>
    var $report;
    function loadReport(accessToken, embedReportId, embedUrl){

        // Read embed application token from Model
        // Read embed URL from Model@Html.Raw(Model.EmbedUrl)
        // var embedUrl = "https://app.powerbi.com/reportEmbed?reportId=fddcd03a-d3cb-402c-81a6-bc80d0ec4c96&groupId=3828d97d-072c-4605-995f-37f9abc5d177&config=eyJjbHVzdGVyVXJsIjoiaHR0cHM6Ly93YWJpLXNvdXRoLWVhc3QtYXNpYS1yZWRpcmVjdC5hbmFseXNpcy53aW5kb3dzLm5ldC8ifQ%3D%3D";

        // Read report Id from Model @Model.Id
        // var embedReportId = "fddcd03a-d3cb-402c-81a6-bc80d0ec4c96";

        // Get models. models contains enums that can be used.
        const models = window['powerbi-client'].models;

        // Embed configuration used to describe what and how to embed.
        // This object is used when calling powerbi.embed.
        // This also includes settings and options such as filters.
        // You can find more information at https://github.com/Microsoft/PowerBI-JavaScript/wiki/Embed-Configuration-Details.
        const config = {
            type: 'report',
            tokenType: models.TokenType.Embed,
            accessToken: accessToken,
            embedUrl: embedUrl,
            id: embedReportId,
            permissions: models.Permissions.All,
            settings: {
                filterPaneEnabled: true,
                navContentPaneEnabled: true
            }
        };

        // Get a reference to the embedded report HTML element
        const reportContainer = $('#reportContainer')[0];

        // Embed the report and display it within the div container.
        $report = powerbi.embed(reportContainer, config);
    }

    function refreshToken(){
        fengtoos.server({
            urlType: "AAD",
            url: pbiGroupEmbedToken,
            async: true,
            data: {
                accessLevel: "View"
            },
            success: function(rs){
                $report.setAccessToken(rs.token);
            }
        })
    }

    fengtoos.server({
        urlType: "AAD",
        url: pbiGroupEmbedToken,
        async: true,
        data: {
            accessLevel: "View"
        },
        success: function(rs){
            let token = rs.token;
            loadReport(token, "c4836748-98d1-435f-b7b3-12b1fffd1b63", "https://app.powerbi.com/reportEmbed?reportId=c4836748-98d1-435f-b7b3-12b1fffd1b63")
        }
    })

    // Refresh the token
    setInterval('refreshToken()', 3500000);
</script>
